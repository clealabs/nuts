# NUT-XX: STARK-proven Computations (Cairo)


`optional`

`depends on: NUT-10`

---


This NUT describes the use of STARK proofs (Cairo) which defines a spending condition based on [NUT-10][10]'s well-known `Secret` format. Using Cairo, we can lock ecash tokens requiring a valid STARK proof of some program defined by the sender is provided to the Mint by the receiver.

## STARK-proven-Computation

[NUT-10][10] Secret `kind: Cairo`

If for a `Proof`, `Proof.secret` is a `Secret` of kind `Cairo`, the proof must be unlocked by providing a witness `Proof.witness` and one or more valid signatures in the array `Proof.witness.signatures`.

When spending a locked token, the mint requires a valid STARK proof-of-computation in `Proof.witness.stark_proof` *TODO: check that this is the correct name* of the corresponding program hash in `Proof.Secret.data`.

To give a concrete example of the basic case, to mint a locked token we first create a Cairo `Secret` that read:

```json
[
  "Cairo",
  {
    "nonce": "859d4935c4907062a6297cf4e663e2835d90d97ecdd510745d32f6816323a41f",
    "data": "0249098aa8b9d2fbec49ff8598feb17b592b986e62319a4fa488a3dc36387157a7",
    "tags": [["sigflag", "SIG_INPUTS"]]
  }
]
```

Here, `Secret.data` is the *TODO: INSERT HASHING METHOD HERE* hash of the program of which the witness will have to provide a stark proof-of-computation of. We serialize this `Secret` to a string in `Proof.secret` and get a blind signature by the mint that is stored in `Proof.C` (see [NUT-03][03]]).

The recipient that has a STARK proof-of-computation of a program whose hash corresponds to the one present in `Secret.data` can spend this proof by providing the stark proof on the serialized `Proof.secret` string that is then added to `Proof.witness.stark_proof`:

```json
{
  "amount": 1,
  "secret": "[\"Cairo\",{\"nonce\":\"859d4935c4907062a6297cf4e663e2835d90d97ecdd510745d32f6816323a41f\",\"data\":\"0249098aa8b9d2fbec49ff8598feb17b592b986e62319a4fa488a3dc36387157a7\",\"tags\":[[\"sigflag\",\"SIG_INPUTS\"]]}]",
  "C": "02698c4e2b5f9534cd0687d87513c759790cf829aa5739184a3e3735471fbda904",
  "id": "009a1f293253e41e",
  "witness": "{\"claim\":{\"public_data\":{\"public_memory\":{\"program\":[[0,[2147450879,67600385,0,0,0,0,0,0]],[1,[2,0,0,0,0,0,0,0]],[2,[2147581952,285507585,0,0,0,0,0,0]],[3,[4,0,0,0,0,0,0,0]],[4,[2147450879,17268737,0,0,0,0,0,0]],[5,[0,0,0,0,0,0,0,0]]]]}}}..."
}
```

#### Witness Format
`CairoWitness` is a serialized JSON string of the form

```json
{
  "stark_proof": <json_str>,
}
```


#### Proving Scheme

To spend a token locked with `Cairo`, the spender needs to include the STARK proof in the spent proofs. We use STARK proofs of [Cairo Programs] execution generated by the [stwo-cairo] prover.





## Mint info setting

The [NUT-06][06] `MintMethodSetting` indicates support for this feature:

```json
{
  "xx": {
    "supported": true
  }
}
```


[00]: 00.md
[01]: 01.md
[02]: 02.md
[03]: 03.md
[04]: 04.md
[05]: 05.md
[06]: 06.md
[07]: 07.md
[08]: 08.md
[09]: 09.md
[10]: 10.md
[11]: 11.md
[12]: 12.md
[Cairo Programs]: https://www.cairo-lang.org/
[STWO-Cairo]: https://github.com/starkware-libs/stwo-cairo
